<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>RPI — Relationship Index Test</title>

<style>
  body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial; margin:0; padding:20px; background:#fff; color:#111; }
  .card { max-width:820px; margin:12px auto; border:1px solid #eee; border-radius:12px; padding:18px; box-shadow:0 6px 18px rgba(0,0,0,0.03); }
  h1 { margin:0 0 10px; font-size:22px; color:#d6336c; }
  p.lead { margin:6px 0 18px; color:#444; }

  .lang-switch { display:flex; gap:16px; font-size:15px; margin-bottom:16px; }
  .lang-switch span { cursor:pointer; padding:4px 8px; border-radius:6px; }
  .lang-active { background:#ffdce8; color:#c2185b; font-weight:600; }

  .question { margin:16px 0; }
  .q-title { margin-bottom:8px; font-weight:600; }
  .scale { display:flex; gap:8px; flex-wrap:wrap; }
  .scale label { background:#f6f6f6; padding:8px 10px; border-radius:8px; cursor:pointer; user-select:none; border:1px solid transparent; }
  .scale input { display:none; }
  .scale input:checked + span { background:#ffdfe9; border-color:#e68ab1; }

  .controls { display:flex; gap:12px; margin-top:18px; }
  button { padding:10px 16px; border-radius:10px; border:0; cursor:pointer; font-weight:600; font-size:15px; }
  .primary { background:#ff3b61; color:white; }
  .secondary { background:#f1f1f1; color:#333; }

  .result { margin-top:20px; padding:16px; border-radius:12px; background:#fff7fb; border:1px solid #ffd8e8; }
  .subscore { margin:8px 0; }

  .footer { font-size:12px; color:#666; margin-top:16px; }
</style>
</head>

<body>
<div class="card" id="app">

  <!-- Language Toggle -->
  <div class="lang-switch">
    <span id="lang-en" class="lang-active">English</span>
    <span id="lang-zh">中文</span>
  </div>

  <!-- Title + Intro -->
  <h1 id="title"></h1>
  <p class="lead" id="lead"></p>

  <!-- Quiz -->
  <form id="quiz"></form>

  <div id="output"></div>

  <div class="footer" id="footer"></div>
</div>

<script>
/* Language data */
const text = {
  en: {
    title: "RPI — Relationship Index Test",
    lead: "A quick 8-item psychological insight tool measuring control, jealousy, dependence & insecurity.",
    footer: "This tool is for entertainment/insight only. Not a clinical diagnosis.",

    questions: [
      "I try to control who my partner talks to.",
      "I feel jealous when my partner talks to others.",
      "I rely on my partner to feel emotionally stable.",
      "I often worry that my relationship is not secure.",
      "I tell my partner what to wear or how to behave.",
      "I check my partner's phone or messages without permission.",
      "I feel anxious when my partner is not around.",
      "I worry my partner might leave me even without signs."
    ],

    btnGet: "Get my report",
    btnReset: "Reset",

    labels: ["Low", "Low-Moderate", "Moderate — be aware", "High — may need attention"],

    reportTitle: "Your RPI Quick Report",
    print: "Print / Save Report"
  },

  zh: {
    title: "RPI — 亲密关系指数测试",
    lead: "共 8 道题，用于快速评估亲密关系中的控制、嫉妒、依赖与不安全感。",
    footer: "本测试仅用于自我洞察，非专业心理诊断。",

    questions: [
      "我会试图控制伴侣与谁聊天。",
      "当伴侣与别人聊天时，我会感到嫉妒。",
      "我在情绪上非常依赖伴侣。",
      "我常常担心我们的关系是否安全。",
      "我会要求伴侣穿什么、怎么表现。",
      "我会在未经同意的情况下查看伴侣的手机或消息。",
      "当伴侣不在身边时，我会感到焦虑。",
      "即使没有迹象，我也会担心伴侣会离开我。"
    ],

    btnGet: "获取测试报告",
    btnReset: "重新填写",

    labels: ["较低", "中低", "中等（需要注意）", "较高（可能需要重视）"],

    reportTitle: "你的 RPI 测试报告",
    print: "打印 / 保存报告"
  }
};

/* Build questions dynamically */
function buildQuiz(lang) {
  const quiz = document.getElementById("quiz");
  quiz.innerHTML = "";

  text[lang].questions.forEach((q, i) => {
    const idx = i + 1;

    quiz.innerHTML += `
      <div class="question">
        <div class="q-title">${idx}. ${q}</div>
        <div class="scale">
          <label><input type="radio" name="q${idx}" value="1"><span>1</span></label>
          <label><input type="radio" name="q${idx}" value="2"><span>2</span></label>
          <label><input type="radio" name="q${idx}" value="3"><span>3</span></label>
          <label><input type="radio" name="q${idx}" value="4"><span>4</span></label>
          <label><input type="radio" name="q${idx}" value="5"><span>5</span></label>
        </div>
      </div>
    `;
  });

  quiz.innerHTML += `
    <div class="controls">
      <button type="button" id="calc" class="primary">${text[lang].btnGet}</button>
      <button type="button" id="reset" class="secondary">${text[lang].btnReset}</button>
    </div>
  `;

  addListeners(lang);
}

/* Scoring & reporting */
function addListeners(lang) {
  document.getElementById("calc").onclick = () => {
    const needed = Array.from({length: 8}, (_,i)=>`q${i+1}`);
    for(let n of needed){
      if(!document.querySelector(`input[name="${n}"]:checked`)){
        alert(lang === "en" ? "Please answer all questions." : "请先回答全部 8 道题。");
        return;
      }
    }

    const resultBox = document.getElementById("output");
    resultBox.innerHTML = "";
    const container = document.createElement("div");
    container.className = "result";

    container.innerHTML += `<strong>${text[lang].reportTitle}</strong><br><br>`;

    // compute averages for groups of 2 items
    const scales = {
      control: ["q1","q5"],
      jealousy: ["q2","q6"],
      dependence: ["q3","q7"],
      insecurity: ["q4","q8"]
    };

    function read(name){
      return Number(document.querySelector(`input[name="${name}"]:checked`).value);
    }

    function interpret(avg){
      if(avg >= 4.2) return text[lang].labels[3];
      if(avg >= 3.2) return text[lang].labels[2];
      if(avg >= 2.2) return text[lang].labels[1];
      return text[lang].labels[0];
    }

    for(const scale in scales){
      const vals = scales[scale].map(read);
      const avg = (vals[0] + vals[1]) / 2;

      container.innerHTML += `<div class="subscore"><strong>${scale}</strong>: 
        ${avg.toFixed(2)} — ${interpret(avg)}</div>`;
    }

    const allVals = needed.map(read);
    const overall = allVals.reduce((a,b)=>a+b,0) / 8;
    container.innerHTML += `<br><em>Overall: ${overall.toFixed(2)} — ${interpret(overall)}</em><br><br>`;

    const printBtn = document.createElement("button");
    printBtn.className = "primary";
    printBtn.textContent = text[lang].print;
    printBtn.onclick = () => window.print();

    container.appendChild(printBtn);
    resultBox.appendChild(container);
  };

  document.getElementById("reset").onclick = () => {
    document.getElementById("quiz").reset();
    document.getElementById("output").innerHTML = "";
  };
}

/* Language switcher */
function applyLang(lang){
  document.getElementById("title").textContent = text[lang].title;
  document.getElementById("lead").textContent = text[lang].lead;
  document.getElementById("footer").textContent = text[lang].footer;
  buildQuiz(lang);

  document.getElementById("lang-en").className = lang==="en" ? "lang-active" : "";
  document.getElementById("lang-zh").className = lang==="zh" ? "lang-active" : "";
}

/* Switch click */
document.getElementById("lang-en").onclick = () => applyLang("en");
document.getElementById("lang-zh").onclick = () => applyLang("zh");

/* Default language */
applyLang("en");
</script>

</body>
</html>
